<div class="video-detail-container">
  <div class="detail-header">
    <h2>{{ video.name }}</h2>
    <button class="close-btn" (click)="closePanel()">‚úï</button>
  </div>

  <div class="detail-content">
    <!-- Video Information -->
    <div class="info-section">
      <h3>Video Information</h3>
      
      <div class="info-row">
        <label>Name:</label>
        <span>{{ video.name }}</span>
      </div>

      <div class="info-row">
        <label>File Path:</label>
        <span class="file-path">{{ video.file_path }}</span>
      </div>

      <div class="info-row">
        <label>Created:</label>
        <span>{{ video.created_at | date:'medium' }}</span>
      </div>

      <div class="info-row" *ngIf="video.roi">
        <label>ROI (Region of Interest):</label>
        <pre class="json-display">{{ formatJSON(video.roi) }}</pre>
      </div>

      <div class="info-row" *ngIf="video.calibrate_coordinates">
        <label>Calibrate Coordinates:</label>
        <pre class="json-display">{{ formatJSON(video.calibrate_coordinates) }}</pre>
      </div>
    </div>

    <!-- Stream Section -->
    <div class="stream-section">
      <div class="stream-controls">
        <button 
          *ngIf="!isStreaming" 
          class="btn-primary stream-btn"
          (click)="startStream()">
          ‚ñ∂ Start Stream
        </button>
        
        <button 
          *ngIf="isStreaming" 
          class="btn-danger stream-btn"
          (click)="stopStream()">
          ‚èπ Stop Stream
        </button>

        <span *ngIf="isStreaming" class="streaming-indicator">
          <span class="pulse"></span>
          Streaming...
        </span>
      </div>

      <div *ngIf="error" class="error-message">
        {{ error }}
      </div>

      <!-- Video Display (Full CSR) -->
      <div class="video-display">
        <div *ngIf="!mjpegStreamUrl && !isStreaming" class="placeholder">
          <div class="placeholder-icon">üé¨</div>
          <p>Click "Start Stream" to begin streaming video frames</p>
        </div>

        <div *ngIf="isStreaming && !mjpegStreamUrl" class="loading-frame">
          <div class="spinner"></div>
          <p>Waiting for frames...</p>
        </div>

        <!-- Full CSR: MJPEG video stream + Canvas overlay -->
        <div *ngIf="mjpegStreamUrl" class="video-container" style="position: relative; width: 100%;">
          <img 
            [src]="mjpegStreamUrl" 
            alt="Video Stream"
            class="video-stream"
            style="width: 100%; height: auto; display: block;">
          
          <canvas 
            #videoCanvas 
            class="detection-overlay"
            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Stats Section -->
    <div class="stats-section">
      <h3>Stats</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Frame Number</div>
          <div class="stat-value">{{ frameNumber }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Vehicles</div>
          <div class="stat-value">{{ totalVehicles }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Current Vehicles</div>
          <div class="stat-value">{{ vehicles.length }}</div>
        </div>
      </div>
    </div>

    <!-- Vehicles Section -->
    <div class="vehicles-section">
      <h3>Vehicles ({{ totalVehicles }} detected)</h3>
      <div *ngIf="vehicles.length === 0" class="no-vehicles">
        <p>No vehicles detected yet</p>
      </div>
      <div class="vehicle-list">
        <div *ngFor="let vehicle of vehicles" class="vehicle-card" [style.border-left]="'4px solid ' + getVehicleColor(vehicle.track_id)">
          <div class="vehicle-header">
            <div class="vehicle-id">ID: {{ vehicle.track_id }}</div>
            <div class="vehicle-speed" [ngClass]="{'high-speed': vehicle.speed > 80}">
              {{ vehicle.speed.toFixed(1) }} {{ vehicle.speed_unit }}
            </div>
          </div>
          <div class="vehicle-info">
            <div class="vehicle-bbox">
              <span class="label">BBox:</span>
              <span class="value">[{{ vehicle.bbox.x1 }}, {{ vehicle.bbox.y1 }}] - [{{ vehicle.bbox.x2 }}, {{ vehicle.bbox.y2 }}]</span>
            </div>
            <div class="vehicle-confidence">
              <span class="label">Confidence:</span>
              <span class="value">{{ (vehicle.confidence * 100).toFixed(1) }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
