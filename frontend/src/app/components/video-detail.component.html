<div class="video-detail-container">
  <div class="detail-header">
    <h2>{{ video.name }}</h2>
    <button class="close-btn" (click)="closePanel()">‚úï</button>
  </div>

  <div class="detail-content">
    <!-- Video Information (HIDE ROI, File Path, Calibrate Coordinates) -->
    <div class="info-section">
      <h3>Video Information</h3>
      
      <div class="info-row">
        <label>Name:</label>
        <span>{{ video.name }}</span>
      </div>
      
      <div class="info-row">
        <label>FPS:</label>
        <span>{{ video.fps }}</span>
      </div>
      
      <div class="info-row" *ngIf="video.created_at">
        <label>Uploaded:</label>
        <span>{{ video.created_at | date:'medium' }}</span>
      </div>
      
      <!-- REMOVED: File Path, ROI, Calibrate Coordinates -->
      <!-- These are kept in the API response but hidden from UI -->
    </div>

    <!-- Stream Section (KEEP AS-IS) -->
    <div class="stream-section">
      <div class="stream-controls">
        <button 
          *ngIf="!isStreaming" 
          class="btn-primary stream-btn"
          (click)="startStream()">
          ‚ñ∂ Start Stream
        </button>
        
        <button 
          *ngIf="isStreaming" 
          class="btn-danger stream-btn"
          (click)="stopStream()">
          ‚èπ Stop Stream
        </button>

        <span *ngIf="isStreaming" class="streaming-indicator">
          <span class="pulse"></span>
          Streaming...
        </span>
      </div>

      <div *ngIf="error" class="error-message">
        {{ error }}
      </div>

      <!-- Video Display with Canvas Overlay -->
      <div class="video-display">
        <div *ngIf="!currentFrame && !isStreaming" class="placeholder">
          <div class="placeholder-icon">üé¨</div>
          <p>Click "Start Stream" to begin streaming video frames</p>
        </div>

        <div *ngIf="isStreaming && !currentFrame" class="loading-frame">
          <div class="spinner"></div>
          <p>Waiting for frames...</p>
        </div>

        <div *ngIf="currentFrame" class="video-container">
          <img 
            #videoImage
            [src]="currentFrame" 
            alt="Video Frame"
            class="video-frame"
            (load)="drawROI()">
          <canvas 
            #canvasOverlay
            class="canvas-overlay">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Analytics Section (from analytics channel) -->
    <div class="stats-section">
      <h3>Analytics</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Vehicles</div>
          <div class="stat-value">{{ stats.total_vehicles }}</div>
        </div>
        <div class="stat-card highlight">
          <div class="stat-label">Speeding Now</div>
          <div class="stat-value speeding">{{ stats.speeding_count }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Active in ROI</div>
          <div class="stat-value">{{ stats.current_in_roi }}</div>
        </div>
      </div>
    </div>

    <!-- Speeding Vehicles Section (append-only) -->
    <div class="vehicles-section">
      <div class="section-header">
        <h3>Speeding Vehicles (&gt;60 km/h)</h3>
        <button class="btn-secondary" (click)="clearSpeedingList()">Clear List</button>
      </div>
      
      <div class="vehicle-list" *ngIf="speedingVehicles.length > 0">
        <div class="vehicle-card" 
             *ngFor="let vehicle of speedingVehicles; trackBy: trackByTrackId"
             [style.border-left-color]="getVehicleColor(vehicle.track_id)">
          <div class="vehicle-header">
            <div class="vehicle-id">ID: {{ vehicle.track_id }}</div>
            <div class="vehicle-speed danger">{{ vehicle.speed.toFixed(1) }} km/h</div>
          </div>
          <div class="vehicle-info">
            <span class="badge class-{{ vehicle.class_id }}">
              {{ vehicle.class_id === 2 ? 'Car' : vehicle.class_id === 7 ? 'Truck' : vehicle.class_id === 3 ? 'Motorcycle' : 'Bus' }}
            </span>
            <span class="confidence">{{ (vehicle.confidence * 100).toFixed(0) }}%</span>
            <span class="timestamp" *ngIf="vehicle.detectedAt">{{ vehicle.detectedAt ? formatTime(vehicle.detectedAt) : 'N/A' }}</span>
          </div>
        </div>
      </div>
      
      <div class="empty-state" *ngIf="speedingVehicles.length === 0 && isStreaming">
        <p>No speeding vehicles detected yet</p>
      </div>
      
      <div class="empty-state" *ngIf="!isStreaming">
        <p>Start streaming to monitor speeding vehicles</p>
      </div>
    </div>
  </div>
</div>
